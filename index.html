import { database } from './firebase.js';
import { ref, push, set } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

async function register() {
  const name = document.getElementById("name").value;
  const parcel = document.getElementById("parcel").value;
  const matric = document.getElementById("matric").value;
  const phone = document.getElementById("phone").value;

  if (!name || !parcel || !matric || !phone) {
    alert("Please fill in all fields!");
    return;
  }

  const generatedCode = Math.floor(1000 + Math.random() * 9000);
  document.getElementById("generatedNumber").textContent =
    "Your Code: " + generatedCode;

  try {
    // Reference to 'parcels' node
    const parcelsRef = ref(database, 'parcels');
    // Generate a new unique key and get its reference
    const newParcelRef = push(parcelsRef);
    
    await set(newParcelRef, {
      name,
      parcel,
      matric,
      phone,
      generatedCode,
      timestamp: Date.now()
    });

    alert("Parcel registered successfully!");
  } catch (error) {
    console.error("Error saving data:", error);
    alert("Failed to register parcel.");
  }
}
